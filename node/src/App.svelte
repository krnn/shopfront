<script>
	import { onMount } from 'svelte';
	import Router from 'svelte-spa-router';
    import { getLocation, fetchCart } from './service.js';
	import Cart from './screens/Cart.svelte'
	import Shop from './screens/Shop.svelte'
	import Checkout from './screens/Checkout.svelte'
	import ProductPage from './screens/ProductPage.svelte'
	import { userLocation, setLocation } from './stores.js';
	onMount(() => {
		if ($userLocation === null) getLocation()
	})
    onMount(fetchCart)
</script>

{#if $userLocation==='xx'}
<div class="flex justify-center items-center bg-primary-200 fixed bottom-0 h-fit w-full bg-opacity-70 z-40">
	<div class="bg-white p-6 text-center shadow-md rounded">
		<h1 class="text-grey-500 text-xl mb-2">Please select a region</h1>

		<button class="btn-local btn-m" on:click={() => setLocation('oo')}>
			<svg class="inline-block h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13.23 13.23">
				<path d="M6.61.08A6.59 6.59 0 00.07 6.75a6.6 6.6 0 005.88 6.38 6.59 6.59 0 006.76-4.14A6.56 6.56 0 006.61.1zm.02.16c1.23 0 2.45.37 3.47 1.04-.65-.31-.5.37-.13.62.23.25.42.48.04.11-.07.28-.43 1.3-.8.6-.5-.5-.95.39-1.17.77-.52.76 1.03 1.02.69.12.22-.5.88.87.11.91-.43.25-1.08.39-1.18.96-.15.27-.48 1.32.15.84.2-.61 1.29-.3 1.3-.33-.16-.87.4.73.69.02.48-.32.8.84.09.75-.7.33-1.2-.46-1.84-.23-.66.3-1.18.93-1.39 1.62-.1.8.8 1.3 1.5 1.15.88.01.67 1.1.64 1.7-.17.82.83.85 1.1.21.56-.69.87-1.53 1.36-2.26.2-.75-1.17-.9-.83-1.72.38-.2.48 1.44 1.12.75.66-.41-.02-.9-.28-1.27.75-.35 1.45.65 1.26 1.15.18-.23.23-1.49.42-.65A6.35 6.35 0 011.7 10.68a6.35 6.35 0 01-.05-8.05C1.32 3.9.45 5.17.87 6.53c.07-.64.17.53.27.67.23.52.77.83 1.06 1.31.4.4.28 1.03.45 1.47.53.62 1 1.31 1.25 2.1.12.27 1.08.75.5.18.02-.77.93-1.22.9-2-.24-.5-.89-.6-1.24-1.04-.43-.35-.89-.72-1.45-.83-.7.17-.53-1.08-1.1-1.31-.34-.47.57-.37.86-.41.13-.75.95-1.06 1.38-1.65.11-.3.82-.34.49-.89-.23-.78-.99-.57-1.15.1-.4.15-.49-1.02.04-1.11.33-.04.89-.83.44-.81-.75.52-.97-.7-.47-1.09.48-.34 1.1-.46 1.64-.7C5.35.35 6 .25 6.64.25zm-1.36.79c-.46-.28-1.26 1.04-.46.54.22-.05 1.23-.45.46-.54zm.95.06C5.38 1 4.79 1.86 5.1 2.54c-.42.59.1 1.58.64.73.49-.41 1.03-1 .93-1.7-.06-.23-.25-.4-.46-.48zm-2.26.22c-.4-.02-.25.37 0 0zm-.16.17c-.63.11.27.35 0 0zm-.39.12c-.66.05-.02 1.08.06.27-.1-.05-.19-.2-.06-.27zm.81.4c-.39.29-.26 1.07-.14 1.34.4-.24.5-1.04.14-1.35zm2.2 1.2c-.07.57.83 0 .17 0H6.5zm1.1.9c-.42.38.6 1.14.22.37l-.22-.36zm-.1.4c-.56.16.3.58 0 0zm-3.97.4c-.05.22-.28-.05 0 0zM2.14 7.23c.14.57.73.12 0 0zm.63.42c-.19.49.54 0 0 0zm8.25 2.4c-.45.04-.6 1.2-.15.46.09-.14.16-.3.15-.46z" fill="#9999a0"/>
			  </svg><br>
			Outside India
		</button>

		<button class="btn-local btn-m" on:click={() => setLocation('IN')}>
			<svg class="inline-block h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13.229 13.229">
				<path d="M4.454 12.008c-.53-.357-.365-1.118-.739-1.594-.113-.478-.304-.924-.47-1.382-.173-.604-.26-1.25-.145-1.87-.024-.24-.053-.669-.166-.222-.385.452-1.122-.145-1.06-.56.234.077.467-.108.083-.153-.577-.113-.214-.725.249-.58.363.044.652-.091.339-.436-.4-.473.143-.757.55-.822.358-.428.944-.632 1.156-1.176.52-.335-.632-.465-.279-.986.16-.405-.407-.89.24-.98.5-.147.799.364 1.264.448.355.058.851.24.403.616-.402.199.022.656-.342.904.432.285.629.832.528 1.252.41.465 1.062.464 1.562.748.345.123 1.061.352.908-.223.34-.535.337.42.783.263.333.047.78-.113.639-.479.303-.126.593-.362.786-.516.414-.264 1.103.265.708.652-.426.249-.636.685-.647 1.165-.307.259-.433.604-.548.994-.17.042.142-.85-.18-.582-.196.366-.572-.288-.104-.323.416-.434-.413-.223-.606-.346-.072-.223-.503-.55-.633-.31.153.213.188.32-.02.511.165.29.502.837.304 1.14-.43-.031-.825.07-.907.555-.495.28-.855.698-1.308 1.019-.387.27-.927.427-1.128.865.193.51-.126 1.001-.165 1.51-.225.325-.596.842-1.055.898z" fill="#9999a0" stroke-width="1.857"/>
			</svg><br>
			Within India
		</button>
	</div>
</div>
{/if}

<div class="relative min-h-fit bg-grey-100">
	<Router routes={{
		'/': Shop,
		'/product/:id': ProductPage,
		'/checkout': Checkout,
	}} />
	<Cart/>
</div>